{% comment %}
------------------------------------------------------------
专题详情页：Tab + Swiper 轮播
------------------------------------------------------------
{% endcomment %}

<div class="padding-top-120 tabs_topic">
  <div class="session-box padding-bottom-60">
    {% unless section.settings.title == blank %}
      <h2>{{ section.settings.title }}</h2>
    {% endunless %}
  </div>

  <!-- Tab 导航 -->
  <div class="tabs">
    <ul class="tab-titles session-box">
      {% assign tab_index = 0 %}
      {% for block in section.blocks %}
        {% if block.type == 'tab' %}
          <li data-tab="{{ tab_index }}"
              onclick="switchTab({{ tab_index }})"
              class="{% if forloop.first %}active{% endif %}"
              {{ block.shopify_attributes }}>
            {{ block.settings.tab_title | escape }}
          </li>
          {% assign tab_index = tab_index | plus: 1 %}
        {% endif %}
      {% endfor %}
    </ul>

    <!-- Tab 面板 -->
    <div class="tab-contents">
      {% assign tab_count = tab_index %}
      {% for i in (0..tab_count-1) %}
        <div class="tab-panel{% unless forloop.first %} hidden{% endunless %}" data-tab-panel="{{ i }}">
          <div class="swiper swiper-{{ i }}">
            <div class="swiper-wrapper">
                {% for block in section.blocks %}
                    {% assign belong_num = block.settings.belong_tab | plus: 0 %}
                    {% if block.type == 'slide' and belong_num == i %}
                      <div class="swiper-slide" {{ block.shopify_attributes }}>
                        {% unless block.settings.image == blank %}
                          <img src="{{ block.settings.image | image_url: width: 800 }}" alt="{{ block.settings.caption | escape }}">
                        {% endunless %}
                        {% unless block.settings.caption == blank %}
                          <p>{{ block.settings.caption }}</p>
                        {% endunless %}
                      </div>
                    {% endif %}
                  {% endfor %}
                  
            </div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  function switchTab(idx) {
    // 激活导航
    document.querySelectorAll('.tabs_topic .tab-titles li').forEach(li=>{
      li.classList.toggle('active', li.dataset.tab == idx);
    });
    // 切换面板
    document.querySelectorAll('.tabs_topic [data-tab-panel]').forEach(p=>{
      p.classList.toggle('hidden', p.dataset.tabPanel != idx);
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.tabs_topic .swiper').forEach(el=>{
      new Swiper(el, {
        loop: true,
        navigation: {
          nextEl: el.querySelector('.swiper-button-next'),
          prevEl: el.querySelector('.swiper-button-prev')
        }
      });
    });
  });
</script>

{% comment %}
──────────────────────── CSS ────────────────────────
{% endcomment %}
<style>
.tabs_topic .tab-titles{
  display:flex;gap:8%;border-bottom:1px solid #E2DED6;list-style:none
}
.tabs_topic .tab-titles li{
  padding-bottom:10px;color:#7F7E75;font-size:2.4rem;font-weight:700;
  border-bottom:2px solid transparent;cursor:pointer;transition:all .3s;
  font-variation-settings:"opsz" auto
}
.tabs_topic .tab-titles li.active,
.tabs_topic .tab-titles li:hover{
  color:#1F1F1F;border-bottom-color:#BDFF00
}
@media(max-width:750px){
  .tabs_topic .tab-titles{flex-direction:column}
}

/* 面板基础 */
.tab-panel.hidden{display:none}

/* Swiper 调整（可按需继续细调） */
.tabs_topic .swiper-slide img{display:block;width:100%;height:auto}
.tabs_topic .swiper-button-prev,
.tabs_topic .swiper-button-next{
  top:50%;width:42px;height:42px;margin-top:-21px;border-radius:50%;
  background:rgba(255,255,255,.8);color:#111;box-shadow:0 2px 6px rgba(0,0,0,.15)
}
.tabs_topic .swiper-button-prev:hover,
.tabs_topic .swiper-button-next:hover{
  background:#111;color:#fff
}
@media(max-width:639px){
  .tabs_topic .swiper-button-prev,
  .tabs_topic .swiper-button-next{display:none}
}
</style>

{% schema %}
{
  "name": "Tabs Topic",
  "tag": "section",
  "class": "section",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section title"
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        { "type": "text", "id": "tab_title", "label": "Tab title" }
      ]
    },
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "select",
          "id": "belong_tab",
          "label": "Belongs to Tab",
          "options": [
            { "value": "0", "label": "Tab 1" },
            { "value": "1", "label": "Tab 2" },
            { "value": "2", "label": "Tab 3" }
          ],
          "default": "0"
        },
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "caption", "label": "Caption" }
      ]
    }
  ],
  "presets": [
    { "name": "Tabs Topic (default)" }
  ]
}
{% endschema %}
