{{ 'section-video-simplicity.css' | asset_url | stylesheet_tag }}
{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 767px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
  
  /* YouTube视频播放时的样式 */
  .video_simplicity_contain.youtube-playing::after {
    display: none !important;
  }
  
  .video_simplicity_contain.youtube-playing .video_simplicity_playicon {
    display: none !important;
  }
  
  /* 普通视频播放时的样式 */
  .video_simplicity_contain.video-playing::after {
    display: none !important;
  }
  
  .video_simplicity_contain.video-playing .video_simplicity_playicon {
    display: none !important;
  }
  
  /* YouTube封面图片样式 */
  .youtube-poster {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }
  
  .youtube-poster img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
{%- endstyle -%}
<div class="video_simplicity_section padding-sider section-{{ section.id }}-padding" id="{{ section.settings.spec_id }}"
  style="background-color: {{ section.settings.background_color }};">
  <div class="video_simplicity">
    <div class="video_simplicity_info">
      {% if section.settings.title != blank %}
        <h2>{{ section.settings.title }}</h2>
      {% endif %}
      {% if section.settings.description != blank %}
        <p class="text-body">{{ section.settings.description }}</p>
      {% endif %}
    </div>
    <div class="video_simplicity_contain">
      {% assign poster_image = blank %}
      {% if section.settings.cover_image != blank %}
        {% assign poster_image = section.settings.cover_image | image_url: width: 2880 %}
      {% endif %}

      {% if section.settings.video_url != blank %}
        {% assign video_url = section.settings.video_url | strip %}
        {% if video_url contains 'youtu.be/' %}
          {% assign video_id = video_url | split: 'youtu.be/' | last | split: '?' | first %}
        {% elsif video_url contains 'youtube.com/watch?v=' %}
          {% assign video_id = video_url | split: 'v=' | last | split: '&' | first %}
        {% else %}
          {% assign video_id = '' %}
        {% endif %}
        {% if video_id != '' %}
          {% if poster_image != blank %}
            <!-- 显示封面图片 -->
            <div class="youtube-poster" id="youtube-poster-{{ section.id }}">
              <img src="{{ poster_image }}" alt="Video poster" style="width: 100%; height: 100%; object-fit: cover;">
            </div>
          {% endif %}
          <iframe id="youtube-iframe-{{ section.id }}" width="100%" height="100%" src="https://www.youtube.com/embed/{{ video_id }}?enablejsapi=1&autoplay=0&controls=0&showinfo=0&rel=0"
            title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen style="{% if poster_image != blank %}display: none;{% endif %}"></iframe>
        {% else %}
          <video
            loop
            playsinline
            preload="auto"
            {% if poster_image != blank %}
              poster="{{ poster_image }}"
            {% endif %}
            src="{{ section.settings.video_url }}"
            controls
          ></video>
          <div class="celebrity_swiper_item_playicon">{{- 'icon-play.svg' | inline_asset_content -}}</div>
        {% endif %} 
      {% else %}
        {{
          section.settings.url_upload
          | video_tag:
            class: 'video_simplicity_video',
            loop: false,
            muted: false,
            playsinline: true,
            preload: 'metadata',
            controls: true,
            poster: poster_image
        }}
      {% endif %}
      {% if section.settings.show_playicon == 'true' %}
        <div class="video_simplicity_playicon">
          {{ 'icon-play.svg' | inline_asset_content }}
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  (() => {
    const video = document.querySelector('.video_simplicity_video');
    const playIcon = document.querySelector('.video_simplicity_playicon');
    const youtubeIframe = document.querySelector('#youtube-iframe-{{ section.id }}');
    const youtubePoster = document.querySelector('#youtube-poster-{{ section.id }}');
    
    if (playIcon) {
      playIcon.addEventListener('click', function () {
        // 如果是YouTube视频
        if (youtubeIframe) {
          // 隐藏播放按钮
          playIcon.style.display = 'none';
          
          // 隐藏封面图片
          if (youtubePoster) {
            youtubePoster.style.display = 'none';
          }
          
          // 显示YouTube iframe
          youtubeIframe.style.display = 'block';
          
          // 移除遮罩层
          const videoContainer = document.querySelector('.video_simplicity_contain');
          if (videoContainer) {
            videoContainer.classList.add('youtube-playing');
          }
          
          // 播放YouTube视频
          const videoId = '{{ video_id }}';
          const newSrc = `https://www.youtube.com/embed/${videoId}?enablejsapi=1&autoplay=1&controls=1&showinfo=0&rel=0`;
          youtubeIframe.src = newSrc;
        }
        // 如果是普通视频
        else if (video) {
          if (video.paused) {
            video.style.zIndex = 2;
            video.play();
            // 隐藏播放按钮
            playIcon.style.display = 'none';
            // 移除遮罩层
            const videoContainer = document.querySelector('.video_simplicity_contain');
            if (videoContainer) {
              videoContainer.classList.add('video-playing');
            }
          } else {
            video.pause();
            // 显示播放按钮
            playIcon.style.display = 'block';
            // 恢复遮罩层
            const videoContainer = document.querySelector('.video_simplicity_contain');
            if (videoContainer) {
              videoContainer.classList.remove('video-playing');
            }
          }
        }
      });
    }
    
    // 监听视频播放状态变化
    if (video) {
      video.addEventListener('play', function() {
        const playIcon = document.querySelector('.video_simplicity_playicon');
        const videoContainer = document.querySelector('.video_simplicity_contain');
        if (playIcon) playIcon.style.display = 'none';
        if (videoContainer) videoContainer.classList.add('video-playing');
      });
      
      video.addEventListener('pause', function() {
        const playIcon = document.querySelector('.video_simplicity_playicon');
        const videoContainer = document.querySelector('.video_simplicity_contain');
        if (playIcon) playIcon.style.display = 'block';
        if (videoContainer) videoContainer.classList.remove('video-playing');
      });
      
      video.addEventListener('ended', function() {
        const playIcon = document.querySelector('.video_simplicity_playicon');
        const videoContainer = document.querySelector('.video_simplicity_contain');
        if (playIcon) playIcon.style.display = 'block';
        if (videoContainer) videoContainer.classList.remove('video-playing');
      });
    }
  })();
</script>

{% schema %}
{
  "name": "video simplicity",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "text",
      "id": "spec_id",
      "label": "specId"
    },
    {
      "type": "radio",
      "id": "show_playicon",
      "label": "show playicon",
      "default": "true",
      "options": [
        {
          "value": "true",
          "label": "yes"
        },
        {
          "value": "false",
          "label": "no"
        }
      ]
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "cover image"
    },
    {
      "type": "text",
      "id": "video_url",
      "label": "video url"
    },
    {
      "type": "video",
      "id": "url_upload",
      "label": "video upload"
    },
    {
      "type": "text",
      "id": "title",
      "label": "title"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "description"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 0
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "背景颜色",
      "default": "#f2f1ed"
    }
  ],
  "presets": [
    {
      "name": "video simplicity"
    }
  ]
}
{% endschema %}
