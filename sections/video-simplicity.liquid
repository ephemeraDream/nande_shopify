{{ 'section-video-simplicity.css' | asset_url | stylesheet_tag }}
{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 767px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}
<div class="video_simplicity_section padding-sider section-{{ section.id }}-padding" id="{{ section.settings.spec_id }}"
  style="background-color: {{ section.settings.background_color }};">
  <div class="video_simplicity">
    <div class="video_simplicity_info">
      {% if section.settings.title != blank %}
        <h2>{{ section.settings.title }}</h2>
      {% endif %}
      {% if section.settings.description != blank %}
        <p class="text-body">{{ section.settings.description }}</p>
      {% endif %}
    </div>
    <div class="video_simplicity_contain">
      {% assign poster_image = blank %}
      {% if section.settings.cover_image != blank %}
        {% assign poster_image = section.settings.cover_image | image_url: width: 2880 %}
      {% endif %}

      {% if section.settings.video_url != blank %}
        {% assign video_url = section.settings.video_url | strip %}
        {% if video_url contains 'youtu.be/' %}
          {% assign video_id = video_url | split: 'youtu.be/' | last | split: '?' | first %}
        {% elsif video_url contains 'youtube.com/watch?v=' %}
          {% assign video_id = video_url | split: 'v=' | last | split: '&' | first %}
        {% else %}
          {% assign video_id = '' %}
        {% endif %}
        {% if video_id != '' %}
          <iframe width="100%" height="100%" src="https://www.youtube.com/embed/{{ video_id }}"
            title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        {% else %}
          <video
            loop
            playsinline
            preload="auto"
            {% if poster_image != blank %}
              poster="{{ poster_image }}"
            {% endif %}
            src="{{ section.settings.video_url }}"
            controls
          ></video>
          <div class="celebrity_swiper_item_playicon">{{- 'icon-play.svg' | inline_asset_content -}}</div>
        {% endif %} 
      {% else %}
        {{
          section.settings.url_upload
          | video_tag:
            class: 'video_simplicity_video',
            loop: true,
            muted: true,
            playsinline: true,
            preload: 'none',
            poster: poster_image
        }}
      {% endif %}
      {% if section.settings.show_playicon == 'true' %}
        <div class="video_simplicity_playicon">
          {{ 'icon-play.svg' | inline_asset_content }}
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  (() => {
    const video = document.querySelector('.video_simplicity_video');
    const playIcon = document.querySelector('.video_simplicity_playicon');
    if (playIcon) {
      playIcon.addEventListener('click', function () {
        if (video.paused) {
          video.style.zIndex = 2;
          video.play();
        } else {
          video.pause();
        }
      });
    }
  })();
</script>

{% schema %}
{
  "name": "video simplicity",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "text",
      "id": "spec_id",
      "label": "specId"
    },
    {
      "type": "radio",
      "id": "show_playicon",
      "label": "show playicon",
      "default": "true",
      "options": [
        {
          "value": "true",
          "label": "yes"
        },
        {
          "value": "false",
          "label": "no"
        }
      ]
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "cover image"
    },
    {
      "type": "text",
      "id": "video_url",
      "label": "video url"
    },
    {
      "type": "video",
      "id": "url_upload",
      "label": "video upload"
    },
    {
      "type": "text",
      "id": "title",
      "label": "title"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "description"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 0
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "背景颜色",
      "default": "#f2f1ed"
    }
  ],
  "presets": [
    {
      "name": "video simplicity"
    }
  ]
}
{% endschema %}
