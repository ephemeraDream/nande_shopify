{{ 'section-subscribe-emails.css' | asset_url | stylesheet_tag }}

<div class="subscribe_emails_section session-box-padding" id="subscribe-emails-{{ section.id }}">
  <div class="subscribe_emails">
    {%- comment -%} 订阅主体和图标现在的父容器 {%- endcomment -%}
    <div class="subscribe_emails_container">
      <div class="subscribe_emails_body">
        <div class="subscribe_emails_title">{{ section.settings.title }}</div>
        
        {%- form 'customer', id: 'ContactFooter', class: 'footer__newsletter newsletter-form' -%}
          <input type="hidden" name="contact[tags]" value="newsletter">
          <div class="newsletter-form__field-wrapper">
            <div class="field">
              <input
                id="NewsletterForm--{{ section.id }}"
                type="email"
                name="contact[email]"
                class="field__input"
                value="{{ form.email }}"
                aria-required="true"
                autocorrect="off"
                autocapitalize="off"
                autocomplete="email"
                {% if form.errors %}
                  autofocus
                  aria-invalid="true"
                  aria-describedby="ContactFooter-error"
                {% elsif form.posted_successfully? %}
                  aria-describedby="ContactFooter-success"
                {% endif %}
                placeholder="{{ 'newsletter.label' | t }}"
                required
              >
              <button
                type="submit"
                class="newsletter-form__button field__button"
                name="commit"
                id="Subscribe"
                aria-label="{{ 'newsletter.button_label' | t }}"
              >
                <span class="btn-text"> {{ section.settings.btn_text }}</span>
              </button>
            </div>

            {%- comment -%} 勾选框区域：修复换行与链接颜色 {%- endcomment -%}
            <div class="subscribe_emails_confirm">
              <label class="subscribe_emails_confirm_label" for="subscribe_confirm_checkbox">
                <input 
                  type="checkbox" 
                  class="subscribe_emails_confirm_checkbox_input" 
                  id="subscribe_confirm_checkbox"
                  required
                >
                <span class="subscribe_emails_confirm_checkbox_custom"></span>
                <div class="subscribe_emails_confirm_text rte-inline">
                  {{ section.settings.confirm_text }}
                </div>
              </label>
            </div>

            <div class="subscribe_emails_error_message" id="subscribe_error_message" style="display: none;">
              <span class="svg-wrapper">{{- 'icon-error.svg' | inline_asset_content -}}</span>
              <span>{{ section.settings.checkbox_error_message | default: "Please check the agreement first" }}</span>
            </div>
          </div>
        {%- endform -%}
      </div>

      {%- comment -%} 社交图标：现在与 subscribe_emails_body 平级，实现平齐 {%- endcomment -%}
      <ul class="list-unstyled list-social" role="list">
        {%- if settings.social_facebook_link != blank -%}
          <li class="list-social__item">
            <a href="{{ settings.social_facebook_link }}" class="link list-social__link">
              <span class="svg-wrapper">{{- 'icon-facebook.svg' | inline_asset_content -}}</span>
            </a>
          </li>
        {%- endif -%}
        {%- if settings.social_instagram_link != blank -%}
          <li class="list-social__item">
            <a href="{{ settings.social_instagram_link }}" class="link list-social__link">
              <span class="svg-wrapper">{{- 'icon-instagram.svg' | inline_asset_content -}}</span>
            </a>
          </li>
        {%- endif -%}
        {%- if settings.social_youtube_link != blank -%}
          <li class="list-social__item">
            <a href="{{ settings.social_youtube_link }}" class="link list-social__link">
              <span class="svg-wrapper">{{- 'icon-youtube.svg' | inline_asset_content -}}</span>
            </a>
          </li>
        {%- endif -%}
        {%- if settings.social_tiktok_link != blank -%}
          <li class="list-social__item">
            <a href="{{ settings.social_tiktok_link }}" class="link list-social__link">
              <span class="svg-wrapper">{{- 'icon-tiktok.svg' | inline_asset_content -}}</span>
            </a>
          </li>
        {%- endif -%}
      </ul>
    </div>
  </div>
</div>

<style>
/* 核心平齐布局 */
.subscribe_emails_container {
  display: flex !important;
  flex-direction: row !important;
  align-items: flex-start !important; /* 顶部对齐，若想完全中心对齐改用 center */
  justify-content: space-between;
  gap: 30px;
  flex-wrap: wrap; /* 移动端自动换行 */
}

.subscribe_emails_body {
  flex: 1;
  min-width: 300px;
}

/* 社交图标排列 */
.list-social {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  gap: 15px;
  list-style: none;
  padding: 0;
  margin: 0 !important; /* 移除顶部外边距以实现平齐 */
  height: 50px; /* 匹配输入框的高度以实现视觉中心对齐 */
}

/* 修复富文本导致的换行问题 */
.rte-inline, .rte-inline p {
  display: inline !important;
  margin: 0 !important;
  padding: 0 !important;
}

.rte-inline a {
  display: inline !important;
  color: #bdff00 !important; 
  text-decoration: underline !important;
}

.rte-inline a:hover {
  color: #ffffff !important;
  opacity: 1;
}

/* 勾选框样式 */
.subscribe_emails_confirm_label {
  display: flex !important;
  align-items: center !important;
  gap: 10px;
  margin-top: 15px;
}

.subscribe_emails_confirm_checkbox_custom {
  width: 16px;
  height: 16px;
  border: 1px solid #ccc;
  flex-shrink: 0;
}

#subscribe_confirm_checkbox {
  display: none !important;
}

.subscribe_emails_confirm_checkbox_input:checked + .subscribe_emails_confirm_checkbox_custom {
  background-color: #bdff00;
  border-color: #bdff00;
}

/* 按钮 Loading 状态 */
.subscribe_emails_section .newsletter-form__button.loading {
  pointer-events: none;
  color: transparent !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  function initSub() {
    const sectionEl = document.getElementById('subscribe-emails-{{ section.id }}');
    if (!sectionEl) return;
    const btn = sectionEl.querySelector('#Subscribe');
    const box = sectionEl.querySelector('#subscribe_confirm_checkbox');
    if (btn && box) {
      btn.addEventListener('click', function(e) {
        if (!box.checked) {
          e.preventDefault();
          alert('Please agree to the terms.');
        }
      });
    }
  }
  initSub();
});
</script>

{% schema %}
{
  "name": "subscribe emails",
  "tag": "section",
  "settings": [
    { "type": "richtext", "id": "title", "label": "title" },
    { "type": "text", "id": "btn_text", "label": "btn text" },
    { "type": "richtext", "id": "confirm_text", "label": "confirm text" }
  ],
  "presets": [{ "name": "subscribe emails" }]
}
{% endschema %}