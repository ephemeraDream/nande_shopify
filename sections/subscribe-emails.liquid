{{ 'section-subscribe-emails.css' | asset_url | stylesheet_tag }}

<div class="subscribe_emails_section session-box-padding" id="subscribe-emails-{{ section.id }}">
  <div class="subscribe_emails">
    {%- comment -%} 订阅主体与图标的横向容器 {%- endcomment -%}
    <div class="subscribe_emails_container">
      <div class="subscribe_emails_body">
        <div class="subscribe_emails_title">{{ section.settings.title }} </div>
        
        {%- form 'customer', id: 'ContactFooter', class: 'footer__newsletter newsletter-form' -%}
          <input type="hidden" name="contact[tags]" value="newsletter"> 
          <div class="newsletter-form__field-wrapper">
            <div class="field">
              <input
                id="NewsletterForm--{{ section.id }}"
                type="email"
                name="contact[email]"
                class="field__input"
                value="{{ form.email }}" 
                placeholder="{{ 'newsletter.label' | t }}"
                required
              >
              <button
                type="submit"
                class="newsletter-form__button field__button"
                name="commit"
                id="Subscribe"
              >
                <span class="btn-text"> {{ section.settings.btn_text }}</span> 
              </button>
            </div>

            <div class="subscribe_emails_confirm">
              <label class="subscribe_emails_confirm_label" for="subscribe_confirm_checkbox">
                <input 
                  type="checkbox" 
                  class="subscribe_emails_confirm_checkbox_input" 
                  id="subscribe_confirm_checkbox"
                  required
                > 
                <span class="subscribe_emails_confirm_checkbox_custom"></span>
                {%- comment -%} 强制行内显示，防止换行 {%- endcomment -%}
                <div class="subscribe_emails_confirm_text rte-inline">
                  {{ section.settings.confirm_text }} 
                </div>
              </label>
            </div>
          </div>
        {%- endform -%}
      </div>

      {%- comment -%} 社交图标列表：恢复所有图标逻辑并修复变形 {%- endcomment -%}
      <ul class="list-unstyled list-social" role="list">
        {%- assign social_icons = "facebook,instagram,youtube,tiktok,twitter,pinterest,snapchat,tumblr,vimeo" | split: "," -%}
        {%- for social in social_icons -%}
          {%- assign social_link = "social_" | append: social | append: "_link" -%}
          {%- if settings[social_link] != blank -%}
            <li class="list-social__item">
              <a href="{{ settings[social_link] }}" class="link list-social__link">
                <span class="svg-wrapper">
                  {%- assign icon_name = "icon-" | append: social | append: ".svg" -%}
                  {{ icon_name | inline_asset_content }} [cite: 18, 20, 22, 24, 26, 28, 30, 32, 34]
                </span>
              </a>
            </li>
          {%- endif -%}
        {%- endfor -%}
      </ul>
    </div>
  </div>
</div>

<style>
/* 1. 整体布局：订阅框与图标平齐 */
.subscribe_emails_container {
  display: flex !important;
  flex-direction: row !important;
  align-items: flex-start !important; /* 对齐到顶部，防止被下方报错信息撑开 */
  justify-content: space-between;
  gap: 20px;
  flex-wrap: wrap;
}

.subscribe_emails_body {
  flex: 1;
  min-width: 300px;
}

/* 2. 社交图标样式：修复变形核心代码 */
.list-social {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important; 
  gap: 15px;
  list-style: none;
  padding: 0;
  margin: 0 !important;
  min-height: 48px; /* 匹配订阅框大概的高度 */
}

.list-social__item {
  display: flex;
  align-items: center;
}

.list-social__link .svg-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  /* 移除固定的 width 和 height，改为 max-width 防止过大，保持原比例 */
  width: auto; 
  height: auto;
}

.list-social__link svg {
  width: 24px; /* 这里只固定宽度，高度会自动按比例缩放 */
  height: auto; 
  fill: currentColor;
}

/* 3. 修复富文本导致的换行问题 */
.rte-inline, .rte-inline p {
  display: inline !important;
  margin: 0 !important;
}

.rte-inline a {
  color: #bdff00 !important; 
  text-decoration: underline !important;
}

/* 4. 勾选框样式 */
.subscribe_emails_confirm_label {
  display: flex !important;
  align-items: center !important;
  gap: 10px;
  margin-top: 15px;
}

.subscribe_emails_confirm_checkbox_custom {
  width: 16px;
  height: 16px;
  border: 1px solid #ccc;
  flex-shrink: 0;
}

#subscribe_confirm_checkbox {
  display: none !important;
}

.subscribe_emails_confirm_checkbox_input:checked + .subscribe_emails_confirm_checkbox_custom {
  background-color: #bdff00; 
  border-color: #bdff00; 
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  function initSub() {
    const sectionEl = document.getElementById('subscribe-emails-{{ section.id }}');
    if (!sectionEl) return;
    const btn = sectionEl.querySelector('#Subscribe');
    const box = sectionEl.querySelector('#subscribe_confirm_checkbox');
    if (btn && box) {
      btn.addEventListener('click', function(e) {
        if (!box.checked) {
          e.preventDefault();
          // 触发之前已有的错误信息显示逻辑
          const errorMsg = sectionEl.querySelector('#subscribe_error_message');
          if(errorMsg) errorMsg.style.display = 'flex'; [cite: 8]
        }
      });
    }
  }
  initSub();
});
</script>

{% schema %}
{
  "name": "subscribe emails",
  "tag": "section",
  "settings": [
    { "type": "richtext", "id": "title", "label": "title" },
    { "type": "text", "id": "btn_text", "label": "btn text" },
    { "type": "richtext", "id": "confirm_text", "label": "confirm text" }
  ],
  "presets": [{ "name": "subscribe emails" }]
}
{% endschema %}