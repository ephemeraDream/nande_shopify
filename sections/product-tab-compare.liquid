{% comment %}
------------------------------------------------------------
Product Tab Compare Section - 产品对比 tab切换
------------------------------------------------------------
{% endcomment %}
<div class="product-tab-compare session-box-padding overflow-hidden padding-top-120 padding-bottom-120" id="product-tab-compare-{{ section.id }}" data-section-id="{{ section.id }}">
    {% unless section.settings.title == blank %}
      <h2 class="padding-bottom-30 session-box-inner">{{ section.settings.title }}</h2>
    {% endunless %}
    <div class="session-box-inner">
      <div class="tab-header">
        <div class="session-box-padding">
          <ul class="tab-titles session-box-inner">
            {% assign tab_index = 0 %}
            {% for block in section.blocks %}
              {% if block.type == 'tab' %}
                <li data-tab="{{ tab_index }}"
                    onclick="switchTab({{ tab_index }}, '{{ section.id }}')"
                    class="{% if forloop.first %}active{% endif %}"
                    {{ block.shopify_attributes }}>
                  {{ block.settings.tab_title | escape }}
                </li>
                {% assign tab_index = tab_index | plus: 1 %}
              {% endif %}
            {% endfor %}
          </ul>
        </div>
      </div>
      <div class="tab-content session-box-inner">
        {% for tab in section.settings.tabs %}
          <div class="tab-panel tab-panel-{{ section.id }} {% if forloop.first %}active{% endif %}" data-tab="{{ forloop.index0 }}">
            <div class="tab-products">
              {% for handle in tab.product_list %}
                {% assign product = all_products[handle] %}
                {% if product %}
                  <div class="tab-product-card">
                    <a href="{{ product.url }}">
                      <img src="{{ product.featured_image | image_url: width: 400 }}" alt="{{ product.title }}">
                      <div class="tab-product-title">{{ product.title }}</div>
                      <div class="tab-product-price">
                        {{ product.price | money_without_trailing_zeros }}
                        {% if product.compare_at_price %}
                          <span class="tab-product-price-op">{{ product.compare_at_price | money_without_trailing_zeros }}</span>
                        {% endif %}
                      </div>
                    </a>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
</div>
<style>
.product-tab-compare .tab-titles{
    display:flex;gap:8%;border-bottom:1px solid #E2DED6;list-style:none;margin-bottom:30px;
    }
.product-tab-compare .tab-titles li{
        padding-bottom:10px;color:#7F7E75;font-size:2.4rem;font-weight:700;
        border-bottom:2px solid transparent;cursor:pointer;transition:all .3s;
        font-variation-settings:"opsz" auto
}
.product-tab-compare .tab-titles li.active,
.product-tab-compare .tab-titles li:hover{
    color:#1F1F1F;border-bottom-color:#BDFF00
}

.product-tab-compare .tab-panel { display: none; }
.product-tab-compare .tab-panel.active { display: block; }
.product-tab-compare .tab-products { display: flex; gap: 2rem; flex-wrap: wrap; }
.product-tab-compare .tab-product-card { width: 200px; border: 1px solid #eee; padding: 1rem; border-radius: 8px; background: #fff; }
.product-tab-compare .tab-product-title { font-size: 1.6rem; margin: 1rem 0 0.5rem; }
.product-tab-compare .tab-product-price { color: #1F1F1F; font-weight: bold; }
.tab-product-price-op { color: #aaa; text-decoration: line-through; margin-left: 0.5rem; }

@media(max-width:750px){
    .product-tab-compare .tab-titles{flex-direction:column}
}
</style>

<script>
    function switchTab(tabIndex, sectionId) {
      var section = document.querySelector('.product-tab-compare[data-section-id="' + sectionId + '"]') || document.getElementById('product-tab-compare-' + sectionId);
      if (!section) section = document.querySelector('.product-tab-compare'); // fallback
      var tabs = section.querySelectorAll('.tab-titles li');
      var panels = section.querySelectorAll('.tab-panel-' + sectionId);
    
      tabs.forEach(function(tab, idx) {
        tab.classList.toggle('active', idx === tabIndex);
      });
      panels.forEach(function(panel, idx) {
        panel.classList.toggle('active', idx === tabIndex);
      });
    }
</script>

{% schema %}
{
  "name": "Product Tab Compare",
  "tag": "section",
  "class": "section",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "title"
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        { "type": "text", "id": "tab_title", "label": "Tab title" },
        {
            "type": "product_list",
            "id": "product_list",
            "label": "product list"
        }
      ]
    },
  ],
  "presets": [
    { "name": "Product Tab Compare (default)" }
  ]
}
{% endschema %}