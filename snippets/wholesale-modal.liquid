<div class="product_info_modal_item">
  <div class="product_info_modal_item_left">
    {{ icon }}
    <span class="product_info_modal_item_title">{{ title }}</span>
  </div>
  {{- 'swiper-right.svg' | inline_asset_content -}}

  <div class="common_modal">
    <div class="common_modal_contain">
      <div class="common_modal_head">
        <span></span>
        <div class="common_modal_close">{{- 'icon-close.svg' | inline_asset_content -}}</div>
      </div>
      <div class="common_modal_body">
        <div class="product_info_modal_title">{{ modal_title }}</div>
        <div class="product_info_modal_content">{{ modal_content }}</div>
        {% comment %}
          {%- form 'contact', id: 'ContactForm', class: contact_form_class -%}
            <input
              autocomplete="email"
              type="email"
              class="field-input"
              name="contact[email]"
              spellcheck="false"
              autocapitalize="off"
              value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}"
              placeholder="Emal*"
              required
            >
            <input
              class="field-input"
              type="text"
              name="contact[Unternehmen]"
              placeholder="Unternehmen (optional)"
            >
            <input
              class="field-input"
              autocomplete="name"
              type="text"
              name="contact[Name]"
              value="{% if form.name %}{{ form.name }}{% elsif customer %}{{ customer.name }}{% endif %}"
              placeholder="Name (optional)"
            >
            <textarea
              rows="6"
              id="ContactForm-body"
              class="field-input"
              name="contact[Nachricht]"
              placeholder="Nachricht (optional)"
            >
              {{- form.body -}}
            </textarea>
            <div class="contact-btn">
              <button type="submit">
                {{ 'common.absenden' | t -}}
                {{- 'icon-commit.svg' | inline_asset_content }}
              </button>
            </div>
          {%- endform -%}
        {% endcomment %}
        <form id="ContactForm" action="/contact" method="post" accept-charset="UTF-8" class="contact_form_class">
          <input type="hidden" name="form_type" value="contact">
          <input type="hidden" name="utf8" value="✓">

          <input type="email" name="contact[email]" required placeholder="Email*">
          <input type="text" name="contact[Unternehmen]" placeholder="Unternehmen (optional)">
          <input type="text" name="contact[Name]" placeholder="Name (optional)">
          <textarea name="contact[Nachricht]" rows="6" placeholder="Nachricht (optional)"></textarea>

          <button type="submit">Absenden</button>
        </form>

        <div id="ContactForm-message" style="display:none;"></div>

        <div id="ContactForm-message" class="contact-message" style="display:none;"></div>
        <div class="product_info_modal_tip">{{ modal_tip }}</div>
      </div>
    </div>
  </div>
</div>

<script>
  () => {
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('ContactForm');
      const messageBox = document.getElementById('ContactForm-message');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        messageBox.style.display = 'none';
        messageBox.innerHTML = '⏳ Senden...';

        const formData = new FormData(form);

        try {
          const res = await fetch('/contact', {
            method: 'POST',
            body: formData,
            headers: { 'X-Requested-With': 'XMLHttpRequest' },
          });

          const text = await res.text();

          if (text.includes('contact[success]')) {
            messageBox.innerHTML = '✅ Vielen Dank! Ihre Nachricht wurde gesendet.';
            messageBox.style.color = 'green';
            form.reset();
          } else {
            messageBox.innerHTML = '❌ Fehler beim Absenden.';
            messageBox.style.color = 'red';
          }
          messageBox.style.display = 'block';
        } catch (err) {
          messageBox.innerHTML = '❌ Netzwerkfehler.';
          messageBox.style.color = 'red';
          messageBox.style.display = 'block';
        }
      });
    });
  };
</script>
